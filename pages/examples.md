---
layout: default
title: Examples
---

# Libraries

# Measure Conversion Status
The following subsections link to measures that have started conversion to FHIR (separated as FHIR STU3 and R4), been fully converted, or are undergoing testing.

## FHIR R4 Conversion in Progress
Measures that are in the process of being converted to FHIR R4

* None at this time

## FHIR R4 Converted Measures
Measures that have been converted to FHIR R4

* [**EXM9**](cql/in-progress/fhir4/EXM9_FHIR4-8.1.000.cql) Exclusive Breast Milk Feeding
* [**EXM71**](cql/in-progress/fhir4/EXM71_FHIR4-9.000.cql) Anticoagulation Therapy for Atrial Fibrillation/Flutter
* [**EXM72**](cql/in-progress/fhir4/EXM72_FHIR4-8.1.000.cql) Antithrombotic Therapy By End of Hospital Day 2
* [**EXM105**](cql/in-progress/fhir4/EXM105_FHIR4-8.1.000.cql) Discharged on Statin Medication
* [**EXM111**](cql/in-progress/fhir4/EXM111_FHIR4-8.0.000.cql) Median Admit Decision Time to ED Departure Time for Admitted Patients
* [**EXM113**](cql/in-progress/fhir4/EXM113_FHIR4-8.1.000.cql) Elective Delivery
* [**EXM190**](cql/in-progress/fhir4/EXM190_FHIR4-8.2.000.cql) Intensive Care Unit Venous Thromboembolism Prophylaxis
* [**EXM349**](cql/in-progress/fhir4/EXM349_FHIR4-2.9.000.cql) HIV Screening
* [**EXM506**](cql/in-progress/fhir4/EXM506_FHIR4-2.0.000.cql) Safe use of opioids - concurrent prescribing

## FHIR R4 Under-Test Measures
Measures that are undergoing testing on their FHIR R4 version

* [**EXM104**](cql/in-progress/fhir4/EXM104_FHIR4-8.1.000.cql) Discharged on Antithrombotic Therapy
* [**EXM108**](cql/in-progress/fhir4/EXM108_FHIR4-8.2.000.cql) Venous Thromboembolism Prophylaxis
* [**EXM124**](cql/in-progress/fhir4/EXM124_FHIR4-8.1.000.cql) Cervical Cancer Screening - [Library](../resources/library/library-exm124-FHIR.json)
* [**EXM125**](cql/in-progress/fhir4/EXM125_FHIR4-8.1.000.cql) Breast Cancer Screening - [Library](../resources/library/library-exm125-FHIR.json)
* [**EXM130**](cql/in-progress/fhir4/EXM130_FHIR4-8.1.000.cql) Breast Cancer Screening - [Library](../resources/library/library-exm130-FHIR.json)
* [**EXM165**](cql/in-progress/fhir4/EXM165_FHIR4-8.5.000.cql) Controlling High Blood Pressure

## FHIR STU3 Conversion in Progress
Measures that are in the process of being converted to FHIR STU3

* [**EXM68**](cql/in-progress/fhir3/EXM_FHIR3-9.1.000.cql) Documentation of Current Medications in the Medical Record
* [**EXM71**](cql/in-progress/fhir3/EXM_FHIR3-9.1.000.cql) Anticoagulation Therapy for Atrial Fibrillation/Flutter
* [**EXM117**](cql/in-progress/fhir3/EXM_FHIR3-1.0.1.cql) Childhood Immunization Status
* [**EXM122**](cql/in-progress/fhir3/EXM_FHIR3-8.1.000.cql) Diabetes: Hemoglobin A1c (HbA1c) Poor Control (> 9%)
* [**EXM135**](cql/in-progress/fhir3/EXM_FHIR3-8.1.000.cql) Heart Failure (HF): Angiotensin-Converting Enzyme (ACE) Inhibitor or Angiotensin Receptor Blocker (ARB) Therapy for Left Ventricular Systolic Dysfunction (LVSD)
* [**EXM146**](cql/in-progress/fhir3/EXM_FHIR3-8.1.000.cql) Appropriate Testing for Children with Pharyngitis

## FHIR STU3 Converted Measures
Measures that have been converted to FHIR STU3

* [**EXM2**](cql/in-progress/fhir3/EXM2_FHIR3-1.1.000.cql) Preventive Care and Screening: Screening for Depression and Follow-Up Plan
* [**EXM72**](cql/in-progress/fhir3/EXM72_FHIR3-8.1.0.cql) Antithrombotic Therapy By End of Hospital Day 2
* [**EXM105**](cql/in-progress/fhir3/EXM105_FHIR3-8.000.cql) Discharged on Statin Medication
* [**EXM111**](cql/in-progress/fhir3/EXM111_FHIR3-8.0.000.cql) Median Admit Decision Time to ED Departure Time for Admitted Patients
* [**EXM135**](cql/in-progress/fhir3/EXM135_FHIR3.cql) Heart Failure (HF): Angiotensin-Converting Enzyme (ACE) Inhibitor or Angiotensin Receptor Blocker (ARB) Therapy for Left Ventricular Systolic Dysfunction (LVSD)
* [**EXM159**](cql/in-progress/fhir3/EXM159_FHIR3-8.5.002.cql) Depression Remission at Twelve Months
* [**EXM161**](cql/in-progress/fhir3/EXM161_FHIR3-8.0.0.cql) Adult Major Depressive Disorder (MDD): Suicide Risk Assessment
* [**EXM177**](cql/in-progress/fhir3/EXM177_FHIR3-8.1.000.cql) Child and Adolescent Major Depressive Disorder (MDD): Suicide Risk Assessment
* [**EXM349**](cql/in-progress/fhir3/EXM349_FHIR3-2.9.000.cql) HIV Screening
* [**EXM506**](cql/in-progress/fhir3/EXM506_FHIR3-2.0.000.cql) Safe use of opioids - concurrent prescribing

## FHIR STU3 Under-Test Measures
Measures that are undergoing testing on their FHIR STU3 version

* [**EXM104**](cql/in-progress/fhir3/EXM104_FHIR3-8.1.000.cql) Discharged on Antithrombotic Therapy
* [**EXM108**](cql/complete/fhir3/EXM108_FHIR3-7.4.000.cql) Venous Thromboembolism Prophylaxis
* [**EXM124**](cql/complete/fhir3/EXM124_FHIR3-7.2.000.cql) Cervical Cancer Screening - [Library](../resources/library/library-exm124-FHIR.json)
* [**EXM125**](cql/complete/fhir3/EXM125_FHIR3-7.2.000.cql) Breast Cancer Screening - [Library](../resources/library/library-exm125-FHIR.json)
* [**EXM130**](cql/complete/fhir3/EXM130_FHIR3-7.2.000.cql) Colorectal Cancer Screening - [Library](../resources/library/library-exm130-FHIR.json)
* [**EXM165**](cql/in-progress/fhir3/EXM165_FHIR3-8.5.000.cql) Controlling High Blood Pressure

# Issues

This section will contain links to trackers that have been submitted for issues encountered during the translation.

Walkthrough examples, specifically identifying gaps and how they were addressed within translation.

Capture and document known gaps.

# Common Patterns and Approaches

NOTE: The examples throughout have been simplified to illustrate specific usage. Refer to the originating context for the complete expression.

## Encounter Examples

### Inpatient Encounter Example

Example source: MATGlobalCommonFunctions

```cql
define "Inpatient Encounter":
	[Encounter: "Encounter Inpatient"] EncounterInpatient
		where EncounterInpatient.status = 'finished'
	    and "LengthInDays"(EncounterInpatient.period) <= 120
			and EncounterInpatient.period ends during "Measurement Period"
```

### Inpatient Encounter with Principal Diagnosis

Example source: EXM105

```cql
define "Inpatient Encounter with Principal Diagnosis of Ischemic Stroke":
  "Inpatient Encounter" Encounter
	  let PrincipalDiagnosis:
		  (singleton from (Encounter.diagnosis D where D.role ~ ToConcept("Billing") and D.rank = 1)) PD
        return singleton from ([Condition: id in Last(Split(PD.condition.reference, '/'))])
	  where PrincipalDiagnosis.code in "Ischemic Stroke"
```

Note that the FHIRHelpers.ToConcept usage is intended to be implicit and will be unnecessary once QUICK is fully supported.

### Inpatient Encounter with Principal Procedure

Example source: VTE-1

```cql
define "Inpatient Encounter With Principal Procedure of SCIP VTE Selected Surgery":
  "Inpatient Encounter" Encounter
	  let PrincipalProcedure:
		  singleton from (
			  Encounter.extension E 
				  where E.url = 'http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter-procedure'
					  and exists (E.extension I where I.url = 'type' and I.value ~ "Primary procedure")
					return singleton from (
							E.extension I where I.url = 'procedure' return GetProcedure(I.value)
						)
			)
		where PrincipalProcedure.code in "SCIP VTE Selected Surgery"
			
define function GetProcedure(reference Reference):
  singleton from ["Procedure": id in GetId(reference.reference))]
	
define function GetId(uri String):
  Last(Split(uri, '/'))
```

## Diagnosis Examples

Example source: EXM72_FHIR-8.1.0_TJC.cql

```cql
define "Condition of Intravenous or Intra arterial Thrombolytic (tPA) Therapy Prior to Arrival":
	[Condition: "Intravenous or Intra arterial Thrombolytic (tPA) Therapy Prior to Arrival"] PriorTPA
		where clinicalStatus in { 'active', 'recurrence', 'relapse' }
```

Note that verificationStatus is not being checked due to feedback received that it may be difficult for implementers to retrieve the element.

## Medications

Example source: EXM108_FHIR

```cql
define "VTE Prophylaxis by Medication Administered":
  ["MedicationAdministration": medication in "Low Dose Unfractionated Heparin for VTE Prophylaxis"] VTEMedication
	  where VTEMedication.status = 'completed'
		  and VTEMedication.dosage.route in "Subcutaneous route"
```

### Medications at discharge

Example source: EXM104_FHIR-8.1.000_TJC.cql

```cql
define "Antithrombotic Therapy at Discharge":
	["MedicationRequest": "Antithrombotic Therapy"] Antithrombotic
	  where exists (Antithrombotic.category C where FHIRHelpers.ToConcept(C) ~ "Discharge")
	    and Antithrombotic.intent = 'order'
```

Note that the FHIRHelpers.ToConcept usage is intended to be implicit and will be unnecessary once QUICK is fully supported.

### Medication not discharged

```cql
define "Antithrombotic Not Given at Discharge":
	["MedicationRequest": "Antithrombotic Therapy"] NoAntithromboticDischarge
	  // STU3
		where exists (
			NoAntithromboticDischarge.extension E 
			  where E.url = 'http://hl7.org/fhir/us/davinci-deqm/STU3/StructureDefinition/extension-doNotPerform' 
				  and E.value is true
		)
		// R4
		//where NoAntithromboticDischarge.doNotPerform is true
			and (singleton from NoAntithromboticDischarge.reasonCode in "Medical Reason"
				or singleton from NoAntithromboticDischarge.reasonCode in "Patient Refusal")

// NOTE: On the assumption that status of not-taken is the closest to what the measure is looking for, this is the expression:				
// Ballot-note: Request discussion w/ Pharmacy regarding how medications not prescribed at discharged would be documented
//define "Antithrombotic Not Given at Discharge R4":
//  ["MedicationStatement": "Antithrombotic Therapy"] AntithromboticTherapy
//	  where AntithromboticTherapy.status = 'not-taken'
//		  and (AntithromboticTherapy.statusReason in "Medical Reason"
//				or AntithrombtoicTherapy.statusReason in "Patient Refusal")
```

### Medication not administered

Example source: EXM108_FHIR

```cql
define "No VTE Prophylaxis Medication Administered":
  ["MedicationAdministration": medication in "Low Dose Unfractionated Heparin for VTE Prophylaxis"] MedicationAdm
		where MedicationAdm.status = 'not-done'
```

### Medication not ordered

Example source: EXM108_FHIR

```cql
define "No VTE Prophylaxis Medication Ordered":
  ["MedicationRequest": medication in "Low Dose Unfractionated Heparin for VTE Prophylaxis"] MedicationOrder
	where MedicationOrder.intent = 'order'
    and MedicationOrder.doNotPerform is true
```

Ballot-note: Note that the MedicationRequest status element is not being checked here. What is the status element expected to be for a MedicationRequest with doNotPerform set to true?

### Medication use

### Non-Medication Substances

### Non-Medication Substance Use

## Procedures/Interventions

Example source: EXM108_FHIR

```cql
define "Intervention Comfort Measures":
	(["ServiceRequest": "Comfort Measures"] P
		where P.intent = 'order')
	union
	(["Procedure": "Comfort Measures"] IntervetionPerformed
		where IntervetionPerformed.status = 'completed')
```

## Care Plan - Care Goals

## Communication

## Devices

### Device Use

Example source: EXM108_FHIR

```cql
define "VTE Prophylaxis by Device Applied":
  (
		["DeviceUseStatement": code in "Intermittent pneumatic compression devices (IPC)"]
  	  union ["DeviceUseStatement": code in "Venous foot pumps (VFP)"]
	    union ["DeviceUseStatement": code in "Graduated compression stockings (GCS)"]
  ) DeviceApplied
		where DeviceApplied.status = 'completed'
```

### Device Not Used

Example source: EXM108_FHIR

```cql
define "No VTE Prophylaxis Device Applied":
   (["DeviceUseStatement": code in "Venous foot pumps (VFP)"]
    union ["DeviceUseStatement": code in "Intermittent pneumatic compression devices (IPC)"]
    union ["DeviceUseStatement": code in "Graduated compression stockings (GCS)"]
  ) DeviceApplied
	  where GetExtension(DeviceApplied.extension, 'http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-deviceusestatement-notDone').value is true
```

### Device Order

### Device Not Ordered

Example source: EXM108_FHIR

```cql
define "No VTE Prophylaxis Device Ordered":
    ["DeviceRequest": code in "Venous foot pumps (VFP)"]
      union ["DeviceRequest": code in "Intermittent pneumatic compression devices (IPC)"]
      union ["DeviceRequest": code in "Graduated compression stockings (GCS)"]
  ) DevideOrder
    where DevideOrder.intent = 'Order'
      and GetExtension(DevideOrder.extension, 'http://hl7.org/fhir/StructureDefinition/request-doNotPerform').value is true
```

## Care Plan - Care Goals

## Adverse Event

## Allergy/Intolerance

## Observations

Example source: EXM108_FHIR

```cql
define "Is In Low Risk for VTE or On Anticoagulant":
	["Observation": code in "Risk for venous thromboembolism"] VTERiskAssessment
		where exists(FHIRHelpers.ToConcept(VTERiskAssessment.value) ~ FHIRHelpers.ToConcept("Low Risk" )
```

Note that the FHIRHelpers.ToConcept usage is intended to be implicit and will be unnecessary once QUICK is fully supported.

### General Observations

### Laboratory tests

### Diagnostic Imaging Studies

### Symptoms

### Vital Signs

#### Blood Pressure

#### BMI

## Family History

## Immunization

## Cross-context queries (e.g to another individuals record)

## Program Participation (e.g. health plan, disease specific program)

## Requests

### Orders

### Recommendations

### Proposals

## Timing Examples

Potentially use Cooking w/ CQL Examples of timing, possibly examples from QDM

[QDM Timing](https://github.com/esacinc/CQL-Formatting-and-Usage-Wiki/blob/master/Source/Cooking%20With%20CQL/36/112_QDMandCQLTimingRedux.cql)

[QDM Timing 2](https://github.com/esacinc/CQL-Formatting-and-Usage-Wiki/blob/master/Source/Cooking%20With%20CQL/35/107_TimingExamples.cql)

Examples of margins and boundaries, and working around them

# Tools
